<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Moving Dot</title>

	<!-- Basic styling, centering the canvas -->
	<style>
	canvas {
		display: block;
		position: absolute;
		margin: auto;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
	</style>
</head>
<body>
<script>
var
/**
 * Constants
 */
WIDTH  = 400,
HEIGHT = 600,
pi = Math.PI,
UpArrow   = 38,
DownArrow = 40,
LeftArrow = 37,
RightArrow = 39,
SpaceBar = 32,
/**
 * Game elements
 */
canvas,
ctx,
keystate,
/**
 * The player paddle
 * 
 * @type {Object}
 */
player = {
	x: WIDTH/2,
	y: HEIGHT-50,
	width:  10,
	height: 10,
	reload: 0,
	reload_time: 10,
	/**
	 * Update the position depending on pressed keys
	 */
	update: function() {
		if (keystate[UpArrow]) this.y -= 7;
		if (keystate[DownArrow]) this.y += 7;
		// keep the paddle inside of the canvas
		this.y = Math.max(Math.min(this.y, HEIGHT - this.height), 0);
		
		
		if (keystate[LeftArrow]) this.x -= 7;
		if (keystate[RightArrow]) this.x += 7;
		// keep the paddle inside of the canvas
		this.x = Math.max(Math.min(this.x, WIDTH - this.height), 0);
		
				
        if (this.x+this.width >= wall.x && this.x <= wall.x+wall.width && this.y < wall.y+wall.height && this.y+7 >= wall.y) {
            this.y = wall.y+wall.height };

        if (this.x+this.width >= wall.x && this.x <= wall.x+wall.width && this.y > wall.y && this.y+7 <= wall.y+this.height) {
            this.y = wall.y-this.height};
		
		
		
		if (keystate[SpaceBar]) {
		    if (this.reload === 0) {
		        bullets.push(new bullet(this.x, this.y));
		        this.reload = this.reload_time;
		        }
		    };
		
		if (this.reload > 0) {this.reload -= 1};
		
	},
	/**
	 * Draw the player paddle to the canvas
	 */
	draw: function() {
		ctx.fillRect(this.x, this.y, this.width, this.height);
	}
},

wall = {
    x: WIDTH/2 - 25,
    y: HEIGHT/2,
    width: 50,
    height: 10,
    update: function() {},
    draw: function() {
        ctx.fillRect(this.x, this.y, this.width, this.height);
        }
},

bullet = function (xpos,ypos) {
    this.info = {
    x: xpos,
	y: ypos,
	width:  5,
	height: 5,
	collision: 0,
    
    update: function() {
             this.y -= 20;
             if (this.x+this.width >= wall.x && this.x <= wall.x+wall.width && this.y+20 >= wall.y && this.y < wall.y) {this.collision = 1};
        },
    
    draw: function() {
        ctx.fillRect(this.x, this.y, this.width, this.height);
        }
   };
},

bullets = [new bullet(player.x, player.y)],
newbullets = bullets.splice(0);
    
function updatebullets() {
    for (i = bullets.length-1; i > -1; i--) {
        bullets[i].info.update();
        if (bullets[i].info.y < 0 || bullets[i].info.collision) {bullets.splice(i, 1)};
    };
}
function drawbullets() {
    for (i = bullets.length-1; i > -1; i--) {
        bullets[i].info.draw();
    };
}


function main() {
	// create, initiate and append game canvas
	canvas = document.createElement("canvas");
	canvas.width = WIDTH;
	canvas.height = HEIGHT;
	ctx = canvas.getContext("2d");
	document.body.appendChild(canvas);
	keystate = {};
	// keep track of keyboard presses
	document.addEventListener("keydown", function(evt) {
		keystate[evt.keyCode] = true;
	});
	document.addEventListener("keyup", function(evt) {
		delete keystate[evt.keyCode];
	});
	init(); // initiate game objects
	// game loop function
	var loop = function() {
		update();
		draw();
		window.requestAnimationFrame(loop, canvas);
	};
	window.requestAnimationFrame(loop, canvas);
}
/**
 * Initatite game objects and set start positions
 */
function init() {
	//player.x = WIDTH/2;
	//player.y = (HEIGHT - player.height)/2;
}
/**
 * Update all game objects
 */
function update() {
	player.update();
	updatebullets();
	console.log(bullets.length);
	wall.update();
	
}
/**
 * Clear canvas and draw all game objects and net
 */
function draw() {
	ctx.fillRect(0, 0, WIDTH, HEIGHT);
	ctx.save();
	ctx.fillStyle = "#fff";
	player.draw();
	drawbullets();
	wall.draw();
	ctx.restore();
}
// start and run the game
main();
</script>
</body>
</html>
